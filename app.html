<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MALIQ — Akıllı Maliyet Hesaplayıcınız</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
  --bg:#061322; --card:#071526; --accent1:#06b6d4; --accent2:#7c3aed; --muted:#9fb0c6;
  --surface: rgba(255,255,255,0.02); --btn-grad: linear-gradient(90deg,var(--accent1),var(--accent2));
  --radius:12px; --font:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}
*{box-sizing:border-box;font-family:var(--font)}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#04111a);color:#eaf4ff}
.container{max-width:720px;margin:0 auto;padding:10px}
.header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.brand{display:flex;gap:8px;align-items:center}
.logo img{width:40px;height:40px;border-radius:8px}
.title{font-weight:800;font-size:16px}
.subtitle{font-size:11px;color:var(--muted);margin-top:-2px}
.search-wrap-centered{width:100%;display:flex;justify-content:center;margin:6px 0 10px 0;position:relative}
.search{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:14px;background:var(--surface);border:1px solid rgba(255,255,255,0.03);width:100%;max-width:680px;position:relative}
.search input{flex:1;background:transparent;border:0;color:inherit;padding:6px 10px;font-size:14px;outline:none}
.search-overlay{position:absolute;left:50%;top:48%;transform:translate(-50%,-4px);pointer-events:none;color:rgba(255,255,255,0.92);font-size:14px;transition:opacity .22s,transform .22s;white-space:nowrap}
.search-overlay.fade{opacity:0;transform:translate(-50%,-12px)}
.tabs{display:flex;gap:6px;margin:10px 0}
.tab{flex:1;padding:10px;border-radius:12px;text-align:center;background:transparent;color:var(--muted);cursor:pointer;border:1px solid rgba(255,255,255,0.03);font-weight:800;display:flex;align-items:center;justify-content:center;font-size:12px}
.tab.active{background:var(--btn-grad);color:#021026;box-shadow:0 6px 20px rgba(2,6,23,0.5)}
.section{background:var(--card);border-radius:12px;padding:10px;border:1px solid rgba(255,255,255,0.03);margin-bottom:10px}

.card-btn{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:10px;border-radius:10px;text-align:center;cursor:pointer;border:1px solid rgba(255,255,255,0.03);transition:transform .12s,box-shadow .12s;display:flex;flex-direction:column;gap:6px;align-items:center;justify-content:center;min-height:70px}
.card-btn .image{width:40px;height:40px;object-fit:cover;border-radius:8px}
.card-btn .name{font-weight:800;font-size:12px;color:inherit}
.card-btn:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(3,10,30,0.45)}

.categories-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
@media(min-width:520px){.categories-grid{grid-template-columns:repeat(4,1fr)}}
.products-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:10px}
@media(min-width:520px){.products-grid{grid-template-columns:repeat(3,1fr)}}

.calc-grid{display:flex;flex-direction:column;gap:6px;margin-top:8px}
.material-item{background:var(--surface);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:6px}
.material-top{display:flex;align-items:center;gap:6px}
.material-image{width:32px;height:32px;object-fit:cover;border-radius:6px}
.row-controls{display:flex;gap:6px;align-items:center;flex-wrap:nowrap;justify-content:space-between}
.left-controls{display:flex;gap:8px;align-items:center;min-width:0}
.right-controls{display:flex;gap:6px;align-items:center;justify-content:flex-end;min-width:220px;flex-shrink:0}
.input-small{padding:6px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:inherit;font-size:13px}
.unit-select{padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:13px}
.cost-amount{font-weight:900;color:var(--accent1);min-width:70px;text-align:right;font-size:13px}
.total-row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:linear-gradient(90deg, rgba(6,182,212,0.04), rgba(124,58,237,0.02));font-weight:900;margin-top:6px;font-size:14px}
.total-row .cost-amount{font-size:18px}
.saved-list{display:flex;flex-direction:column;gap:6px}
.saved-item{background:var(--surface);padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-size:13px;display:flex;flex-direction:column;gap:4px}

.modal{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:none;align-items:center;justify-content:center;z-index:60}
.modal-content{background:var(--card);padding:10px;border-radius:8px;width:95%;max-width:400px}
.btn-primary{padding:8px 12px;border-radius:10px;background:var(--btn-grad);color:#021026;border:0;font-weight:800;cursor:pointer;font-size:13px}
.btn-ghost{padding:6px 10px;border-radius:10px;background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.06);cursor:pointer;font-size:12px}
.footer{margin-top:10px;text-align:center;color:var(--muted);font-size:11px}
.small-note{color:var(--muted);font-size:12px}

.dev-tools{display:none}
.dev-section{background:var(--surface);padding:10px;border-radius:10px;margin-bottom:10px}
.dev-section-title{font-weight:800;margin-bottom:6px;color:var(--accent1);font-size:14px}
.dev-controls{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.dev-input{flex:1;min-width:150px}
.dev-btn{padding:6px 10px;border-radius:8px;background:var(--btn-grad);color:#021026;border:0;font-weight:600;cursor:pointer;font-size:12px}
.dev-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
.dev-stat{background:var(--surface);padding:8px;border-radius:8px;text-align:center}
.dev-stat-value{font-weight:800;font-size:16px;color:var(--accent1)}
.dev-stat-label{font-size:11px;color:var(--muted)}

.management-panel{max-height:300px;overflow-y:auto;border:1px solid rgba(255,255,255,0.03);border-radius:8px;padding:6px}
.management-item{display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)}
.management-item:last-child{border-bottom:none}
.management-item-image{width:32px;height:32px;object-fit:cover;border-radius:4px}
.management-item-name{flex:1;font-size:13px}
.management-item-url{flex:2;padding:4px;border-radius:4px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit;font-size:12px}
.management-item-actions{display:flex;gap:4px}
  /* Quick Add Modal için ek stiller */
#quickProductsText {
  background: var(--surface);
  border: 1px solid rgba(255,255,255,0.1);
  color: inherit;
  font-family: monospace;
  font-size: 13px;
}

.dev-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}

.dev-controls .dev-btn {
  flex: 1;
  min-width: 120px;
}

.site-stats{display:flex;justify-content:space-around;margin:12px 0;padding:6px;background:var(--surface);border-radius:8px}
.stat-item{text-align:center}
.stat-value{font-weight:800;font-size:14px;color:var(--accent1)}
.stat-label{font-size:9px;color:var(--muted)}

.breadcrumb{display:flex;align-items:center;gap:6px;margin-bottom:8px;font-size:13px;flex-wrap:wrap}
.breadcrumb-item{cursor:pointer;color:var(--muted)}
.breadcrumb-item:hover{color:var(--accent1)}

.logout-btn{background:rgba(255,107,107,0.1);border:1px solid rgba(255,107,107,0.3);color:#ff6b6b;padding:6px 12px;border-radius:8px;cursor:pointer;font-size:12px;font-weight:600}

@media (max-width: 480px) {
  .container{padding:8px}
  .tab{padding:8px;font-size:11px}
  .categories-grid{grid-template-columns:repeat(3,1fr);gap:6px}
  .products-grid{grid-template-columns:repeat(2,1fr);gap:6px}
  .row-controls{flex-direction:column;gap:8px}
}
</style>
</head>
<body>
  <div class="container">
    <div class="header-row">
      <div class="brand">
        <div class="logo"><img src="https://i.hizliresim.com/sis5uti.png" alt="logo"></div>
        <div>
          <div class="title">Akıllı Maliyet Hesaplayıcınız</div>
          <div class="subtitle">Maliq sizin 1 porsiyonunuzun maliyetini hesaplar.</div>
        </div>
      </div>
      <div style="display:flex;gap:6px;align-items:center">
        <div style="width:32px;height:32px;border-radius:6px;background:rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center" id="userAvatar">M</div>
        <div style="font-weight:700;font-size:13px" id="userName">Misafir 000001</div>
        <button class="logout-btn" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i> Çıkış
        </button>
      </div>
    </div>

    <div class="search-wrap-centered">
      <div class="search">
        <input id="searchInput" placeholder="" autocomplete="off" />
        <div id="searchOverlay" class="search-overlay">Lahmacun</div>
      </div>
    </div>

    <div class="site-stats">
      <div class="stat-item">
        <div class="stat-value" id="totalRecipes">0</div>
        <div class="stat-label">Yemek Tarifi</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="totalIngredients">0</div>
        <div class="stat-label">Malzeme Çeşidi</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="totalCategories">0</div>
        <div class="stat-label">Kategori</div>
      </div>
    </div>

    <nav class="tabs">
      <div id="tabCategories" class="tab active">KATEGORİLER</div>
      <div id="tabProducts" class="tab">TARİFLER</div>
      <div id="tabCalc" class="tab">HESAPLAMA</div>
      <div id="tabSaved" class="tab">KAYITLAR</div>
      <div id="tabDev" class="tab" style="display:none">GELİŞTİRİCİ</div>
    </nav>

    <main>
      <section id="screenCategories" class="section">
        <div style="font-weight:900;margin-bottom:6px;font-size:14px">Yemek Çeşitleri</div>
        <div id="breadcrumb" class="breadcrumb"></div>
        <div id="categoriesGrid" class="categories-grid"></div>
      </section>

      <section id="screenProducts" class="section" style="display:none">
        <div style="font-weight:900;margin-bottom:6px;font-size:14px" id="productsTitle">Tüm Tarifler</div>
        <div id="productsGrid" class="products-grid"></div>
      </section>

      <section id="screenCalc" class="section" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
          <div>
            <div style="font-weight:900;font-size:14px" id="calcTitle">Hesaplama</div>
            <div id="calcSubtitle" class="small-note"></div>
          </div>
          <div style="display:flex;gap:6px;align-items:center">
            <input id="calcName" class="input-small" placeholder="Ürün adı" style="width:100px" />
            <button id="clearBtn" class="btn-ghost">Temizle</button>
          </div>
        </div>

        <div id="materialsList" class="calc-grid"></div>

        <div class="total-row" id="totalRow" style="display:none">
          <div>Toplam Maliyet</div>
          <div id="totalCost" class="cost-amount">0.00 ₺</div>
        </div>

        <div style="margin-top:8px;display:flex;gap:6px">
          <button id="addMaterialBtn" class="btn-ghost">+ Malzeme Ekle</button>
          <button id="saveBtn" class="btn-primary">Kaydet</button>
        </div>
      </section>

      <section id="screenSaved" class="section" style="display:none">
        <div style="font-weight:900;margin-bottom:6px;font-size:14px">Maliyet Tablom</div>
        <div id="savedList" class="saved-list"></div>
      </section>

      <section id="screenDev" class="section dev-tools" style="display:none">
        <div style="font-weight:900;margin-bottom:12px;color:var(--accent1);font-size:18px;text-align:center">GELİŞTİRİCİ SEÇENEKLERİ</div>
        
        <div class="dev-section">
          <div class="dev-section-title">Kategori Yönetimi</div>
          <div class="dev-controls">
            <input type="text" id="newCategoryName" class="dev-input input-small" placeholder="Kategori Adı">
            <input type="text" id="newCategoryImage" class="dev-input input-small" placeholder="Resim URL">
            <button id="addCategoryBtn" class="dev-btn">Kategori Ekle</button>
          </div>
        </div>
        
        <div class="dev-section">
          <div class="dev-section-title">Ürün Yönetimi</div>
          <div class="dev-controls">
            <input type="text" id="newProductName" class="dev-input input-small" placeholder="Ürün Adı">
            <input type="text" id="newProductImage" class="dev-input input-small" placeholder="Resim URL">
            <button id="addProductBtn" class="dev-btn">Ürün Ekle</button>
          </div>
        </div>

        <div class="dev-section">
          <div class="dev-section-title">Ürün Yönetim Paneli</div>
          <div id="productsManagementPanel" class="management-panel"></div>
        </div>

        <div class="dev-section">
          <div class="dev-section-title">Kategori Yönetim Paneli</div>
          <div id="categoriesManagementPanel" class="management-panel"></div>
        </div>
      </section>
              <div class="dev-section">
          <div class="dev-section-title">Toplu İçerik Ekleme</div>
          <div class="dev-controls">
            <button id="quickAddProductsBtn" class="dev-btn">Hızlı Ürün Ekle</button>
            <button id="exportAllDataBtn" class="dev-btn">Tüm Veriyi Dışa Aktar</button>
            <button id="importAllDataBtn" class="dev-btn">Tüm Veriyi İçe Aktar</button>
            <button id="resetDataBtn" class="dev-btn" style="background:#ff6b6b">Verileri Sıfırla</button>
          </div>
        </div>
      </section>
    </main>

    <div class="footer">CAN&D Şirketinin ürünüdür. Tüm hakları saklıdır © CAN&D</div>
  </div>

  <div id="addModal" class="modal">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <div style="font-weight:900">Malzeme Ekle</div>
        <button id="closeAddModal" class="btn-ghost">Kapat</button>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <input id="addName" class="input-small" placeholder="Malzeme adı" />
        <div style="display:flex;gap:6px">
          <input id="addQty" type="number" class="input-small" value="100" />
          <select id="addUnit" class="unit-select">
            <option value="gr">gr</option><option value="kg">kg</option><option value="ml">ml</option>
            <option value="lt">lt</option><option value="adet">adet</option>
          </select>
        </div>
        <div style="display:flex;gap:6px">
          <input id="addPrice" type="number" class="input-small" placeholder="Fiyat" step="0.01" />
          <select id="addPriceUnit" class="unit-select">
            <option value="kg">₺ / kg</option><option value="gr">₺ / gr</option><option value="adet">₺ / adet</option>
          </select>
        </div>
        <div style="display:flex;gap:6px">
          <button id="confirmAdd" class="btn-primary">Ekle</button>
          <button id="cancelAdd" class="btn-ghost">İptal</button>
        </div>
      </div>
    </div>
  </div>

<script>
// Data
let RECIPES = JSON.parse(localStorage.getItem('maliq_recipes') || '{}');
let CATEGORIES = JSON.parse(localStorage.getItem('maliq_categories') || '[]');
let savedListArr = JSON.parse(localStorage.getItem('maliq_saved')||'[]');
let currentProduct = null;
let calcItems = [];
let currentCategoryPath = [];

// Varsayılan veriler
if (CATEGORIES.length === 0) {
  CATEGORIES = [
    { id: 'kahvalti', name: 'Kahvaltı', imageUrl: 'https://images.unsplash.com/photo-1558961360-f8ddc22e6d43?w=200' },
    { id: 'corba', name: 'Çorba', imageUrl: 'https://images.unsplash.com/photo-1547592166-23ac45744acd?w=200' },
    { id: 'ana', name: 'Ana Yemek', imageUrl: 'https://images.unsplash.com/photo-1563379926898-05f4575a45d8?w=200' },
    { id: 'pide', name: 'Pide', imageUrl: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=200' }
  ];
  localStorage.setItem('maliq_categories', JSON.stringify(CATEGORIES));
}

if (Object.keys(RECIPES).length === 0) {
  RECIPES = {
    "Lahmacun": { 
      category:'pide', 
      imageUrl:'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=200', 
      ingredients:[
        {name:'Un',qty:150,unit:'gr'},
        {name:'Kıyma',qty:150,unit:'gr'}
      ]
    }
  };
  localStorage.setItem('maliq_recipes', JSON.stringify(RECIPES));
}

// Kullanıcı bilgisi
const urlParams = new URLSearchParams(window.location.search);
const isAdmin = urlParams.get('admin') === 'true' || localStorage.getItem('maliq_admin') === 'true';
const userData = JSON.parse(localStorage.getItem('maliq_user') || '{}');

// UI Fonksiyonları
function setupUserInfo() {
  if (isAdmin) {
    document.getElementById('userName').textContent = 'Geliştirici';
    document.getElementById('userAvatar').textContent = 'G';
    document.getElementById('tabDev').style.display = 'flex';
    document.querySelector('.dev-tools').style.display = 'block';
  } else {
    const guestId = localStorage.getItem('maliq_guest_id') || '000001';
    document.getElementById('userName').textContent = 'Misafir ' + guestId;
    document.getElementById('userAvatar').textContent = 'M';
  }
}

function setActiveTab(tab){
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('section').forEach(s => s.style.display = 'none');
  
  if(tab === 'categories') {
    document.getElementById('tabCategories').classList.add('active');
    document.getElementById('screenCategories').style.display = 'block';
  } else if(tab === 'products') {
    document.getElementById('tabProducts').classList.add('active');
    document.getElementById('screenProducts').style.display = 'block';
  } else if(tab === 'calc') {
    document.getElementById('tabCalc').classList.add('active');
    document.getElementById('screenCalc').style.display = 'block';
  } else if(tab === 'saved') {
    document.getElementById('tabSaved').classList.add('active');
    document.getElementById('screenSaved').style.display = 'block';
  } else if(tab === 'dev') {
    document.getElementById('tabDev').classList.add('active');
    document.getElementById('screenDev').style.display = 'block';
  }
}

function renderCategories(){
  const container = document.getElementById('categoriesGrid'); 
  container.innerHTML = '';
  
  const currentParentId = currentCategoryPath.length > 0 ? currentCategoryPath[currentCategoryPath.length - 1] : null;
  const currentCategories = CATEGORIES.filter(cat => !cat.parentId || cat.parentId === currentParentId);
  
  currentCategories.forEach(cat => {
    const d = document.createElement('div'); 
    d.className = 'card-btn';
    d.innerHTML = `<img src="${cat.imageUrl}" class="image" alt="${cat.name}"><div class="name">${cat.name}</div>`;
    d.addEventListener('click', () => { 
      currentCategoryPath.push(cat.id);
      showNestedCategories(cat.id);
    });
    container.appendChild(d);
  });
  
  updateBreadcrumb();
}

function showNestedCategories(parentId) {
  renderCategories();
}

function updateBreadcrumb() {
  const breadcrumbEl = document.getElementById('breadcrumb');
  breadcrumbEl.innerHTML = '';
  
  if (currentCategoryPath.length === 0) {
    breadcrumbEl.style.display = 'none';
    return;
  }
  
  breadcrumbEl.style.display = 'flex';
  
  const homeItem = document.createElement('div');
  homeItem.className = 'breadcrumb-item';
  homeItem.textContent = 'Ana Sayfa';
  homeItem.addEventListener('click', () => {
    currentCategoryPath = [];
    renderCategories();
  });
  breadcrumbEl.appendChild(homeItem);
  
  currentCategoryPath.forEach((catId, index) => {
    const separator = document.createElement('div');
    separator.className = 'breadcrumb-separator';
    separator.textContent = '›';
    breadcrumbEl.appendChild(separator);
    
    const catItem = document.createElement('div');
    catItem.className = 'breadcrumb-item';
    const category = CATEGORIES.find(c => c.id === catId);
    catItem.textContent = category ? category.name : 'Kategori';
    catItem.addEventListener('click', () => {
      currentCategoryPath = currentCategoryPath.slice(0, index + 1);
      showNestedCategories(catId);
    });
    breadcrumbEl.appendChild(catItem);
  });
}

function renderProducts(categoryKey){
  const container = document.getElementById('productsGrid'); 
  container.innerHTML = '';
  const keys = Object.keys(RECIPES).filter(k => !categoryKey || RECIPES[k].category === categoryKey);
  
  keys.forEach(k => { 
    const r = RECIPES[k]; 
    const p = document.createElement('div'); 
    p.className = 'card-btn'; 
    p.innerHTML = `<img src="${r.imageUrl}" class="image" alt="${k}"><div class="name">${k}</div>`; 
    p.addEventListener('click', () => { 
      openCalcFor(k); 
      setActiveTab('calc'); 
    }); 
    container.appendChild(p); 
  });
}

function openCalcFor(name){
  currentProduct = name;
  document.getElementById('calcTitle').textContent = name;
  calcItems = (RECIPES[name] && RECIPES[name].ingredients) ? RECIPES[name].ingredients.map(ing => ({ 
    name: ing.name, 
    qty: ing.qty || 0, 
    unit: ing.unit || 'gr', 
    price: 0, 
    priceUnit: 'kg', 
    calculated: 0 
  })) : [];
  renderCalcItems();
}

function renderCalcItems(){
  const container = document.getElementById('materialsList'); 
  container.innerHTML = '';
  
  if(!calcItems.length){ 
    container.innerHTML = '<div class="small-note">Ürün seçin veya malzeme ekleyin</div>'; 
    document.getElementById('totalRow').style.display = 'none'; 
    return; 
  }
  
  calcItems.forEach((it, idx) => {
    const el = document.createElement('div'); 
    el.className = 'material-item';
    
    el.innerHTML = `
      <div class="material-top">
        <div class="material-name">${it.name} <span style="color:var(--muted);font-weight:600"> ${it.qty} (${it.unit})</span></div>
      </div>
      <div class="row-controls">
        <div class="left-controls">
          <input type="number" id="qty_${idx}" class="input-small" value="${it.qty}" style="width:80px" />
          <select id="unit_${idx}" class="unit-select">
            <option value="gr">gr</option><option value="kg">kg</option><option value="adet">adet</option>
          </select>
        </div>
        <div class="right-controls">
          <input type="number" id="price_${idx}" class="input-small" placeholder="Fiyat (TL)" style="width:100px" />
          <div class="cost-amount" id="cost_${idx}">0.00 ₺</div>
        </div>
      </div>
    `;
    
    container.appendChild(el);

    document.getElementById(`qty_${idx}`).addEventListener('input', e => { 
      it.qty = parseFloat(e.target.value || 0); 
      calculateRow(idx); 
    });
    
    document.getElementById(`price_${idx}`).addEventListener('input', e => { 
      it.price = parseFloat(e.target.value || 0); 
      calculateRow(idx); 
    });
  });
  
  document.getElementById('totalRow').style.display = 'flex';
  calculateTotal();
}

function calculateRow(idx){
  const it = calcItems[idx]; 
  const qty = parseFloat(it.qty || 0); 
  const price = parseFloat(it.price || 0);
  it.calculated = price * qty;
  document.getElementById('cost_' + idx).textContent = it.calculated.toFixed(2) + ' ₺';
}

function calculateTotal(){ 
  let t = 0; 
  calcItems.forEach(it => { 
    t += parseFloat(it.calculated || 0); 
  }); 
  document.getElementById('totalCost').textContent = t.toFixed(2) + ' ₺'; 
}

function saveSnapshot(){ 
  const name = (document.getElementById('calcName').value || currentProduct || 'İsimsiz Ürün').trim(); 
  const total = calculateTotal(); 
  const snap = { 
    name, 
    total, 
    date: new Date().toLocaleString(), 
    items: JSON.parse(JSON.stringify(calcItems))
  }; 
  savedListArr.unshift(snap); 
  localStorage.setItem('maliq_saved', JSON.stringify(savedListArr)); 
  alert('Kaydedildi.'); 
}

function renderSaved(){ 
  const savedListEl = document.getElementById('savedList'); 
  savedListEl.innerHTML = ''; 
  
  savedListArr.forEach((s, i) => { 
    const el = document.createElement('div'); 
    el.className = 'saved-item'; 
    el.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;font-weight:700">
        <div>${s.name}</div>
        <div style="color:var(--accent1)">${s.total.toFixed(2)} ₺</div>
      </div>
      <div class="small-note">${s.date}</div>
    `;
    savedListEl.appendChild(el); 
  }); 
}

// Geliştirici Fonksiyonları
function renderProductsManagementPanel() {
  const container = document.getElementById('productsManagementPanel');
  container.innerHTML = '';
  
  Object.keys(RECIPES).forEach(productName => {
    const product = RECIPES[productName];
    const item = document.createElement('div');
    item.className = 'management-item';
    item.innerHTML = `
      <img src="${product.imageUrl}" class="management-item-image">
      <div class="management-item-name">${productName}</div>
      <input type="text" class="management-item-url" value="${product.imageUrl}">
      <div class="management-item-actions">
        <button class="dev-btn update-product">Güncelle</button>
        <button class="dev-btn delete-product">Sil</button>
      </div>
    `;
    
    item.querySelector('.update-product').addEventListener('click', () => {
      const url = item.querySelector('.management-item-url').value;
      RECIPES[productName].imageUrl = url;
      localStorage.setItem('maliq_recipes', JSON.stringify(RECIPES));
      alert('Güncellendi!');
    });
    
    item.querySelector('.delete-product').addEventListener('click', () => {
      if (confirm('Silinsin mi?')) {
        delete RECIPES[productName];
        localStorage.setItem('maliq_recipes', JSON.stringify(RECIPES));
        renderProductsManagementPanel();
      }
    });
    
    container.appendChild(item);
  });
}

function renderCategoriesManagementPanel() {
  const container = document.getElementById('categoriesManagementPanel');
  container.innerHTML = '';
  
  CATEGORIES.forEach(category => {
    const item = document.createElement('div');
    item.className = 'management-item';
    item.innerHTML = `
      <img src="${category.imageUrl}" class="management-item-image">
      <div class="management-item-name">${category.name}</div>
      <input type="text" class="management-item-url" value="${category.imageUrl}">
      <div class="management-item-actions">
        <button class="dev-btn update-category">Güncelle</button>
        <button class="dev-btn delete-category">Sil</button>
      </div>
    `;
    
    item.querySelector('.update-category').addEventListener('click', () => {
      const url = item.querySelector('.management-item-url').value;
      category.imageUrl = url;
      localStorage.setItem('maliq_categories', JSON.stringify(CATEGORIES));
      renderCategories();
      alert('Güncellendi!');
    });
    
    item.querySelector('.delete-category').addEventListener('click', () => {
      if (confirm('Silinsin mi?')) {
        CATEGORIES = CATEGORIES.filter(c => c.id !== category.id);
        localStorage.setItem('maliq_categories', JSON.stringify(CATEGORIES));
        renderCategoriesManagementPanel();
        renderCategories();
      }
    });
    
    container.appendChild(item);
  });
}

function addCategory() {
  const name = document.getElementById('newCategoryName').value;
  const imageUrl = document.getElementById('newCategoryImage').value;
  if (!name || !imageUrl) return alert('Lütfen tüm alanları doldurun!');
  
  const newCategory = {
    id: name.toLowerCase().replace(/ /g, '_'),
    name: name,
    imageUrl: imageUrl
  };
  
  CATEGORIES.push(newCategory);
  localStorage.setItem('maliq_categories', JSON.stringify(CATEGORIES));
  document.getElementById('newCategoryName').value = '';
  document.getElementById('newCategoryImage').value = '';
  renderCategories();
  renderCategoriesManagementPanel();
  alert('Kategori eklendi!');
}

function addProduct() {
  const name = document.getElementById('newProductName').value;
  const imageUrl = document.getElementById('newProductImage').value;
  if (!name || !imageUrl) return alert('Lütfen tüm alanları doldurun!');
  
  RECIPES[name] = {
    category: 'ana',
    imageUrl: imageUrl,
    ingredients: []
  };
  
  localStorage.setItem('maliq_recipes', JSON.stringify(RECIPES));
  document.getElementById('newProductName').value = '';
  document.getElementById('newProductImage').value = '';
  renderProductsManagementPanel();
  alert('Ürün eklendi!');
}

// Event Listeners
document.getElementById('tabCategories').addEventListener('click', () => {
  setActiveTab('categories');
  currentCategoryPath = [];
  renderCategories();
});

document.getElementById('tabProducts').addEventListener('click', () => {
  setActiveTab('products');
  document.getElementById('productsTitle').textContent = 'Tüm Tarifler';
  renderProducts(null);
});

document.getElementById('tabCalc').addEventListener('click', () => setActiveTab('calc'));
document.getElementById('tabSaved').addEventListener('click', () => { 
  setActiveTab('saved'); 
  renderSaved(); 
});
document.getElementById('tabDev').addEventListener('click', () => { 
  setActiveTab('dev'); 
});

document.getElementById('logoutBtn').addEventListener('click', () => {
  if (confirm('Çıkış yapmak istediğinizden emin misiniz?')) {
    localStorage.removeItem('maliq_user');
    localStorage.removeItem('maliq_admin');
    window.location.href = 'index.html';
  }
});

document.getElementById('addMaterialBtn').addEventListener('click', () => { 
  document.getElementById('addModal').style.display = 'flex'; 
});

document.getElementById('closeAddModal').addEventListener('click', () => { 
  document.getElementById('addModal').style.display = 'none'; 
});

document.getElementById('confirmAdd').addEventListener('click', () => {
  const name = document.getElementById('addName').value || 'Yeni Malzeme';
  const qty = parseFloat(document.getElementById('addQty').value || 0);
  const unit = document.getElementById('addUnit').value;
  const price = parseFloat(document.getElementById('addPrice').value || 0);
  calcItems.push({ name, qty, unit, price, calculated: 0 });
  document.getElementById('addModal').style.display = 'none';
  renderCalcItems();
});

document.getElementById('saveBtn').addEventListener('click', () => saveSnapshot());
document.getElementById('clearBtn').addEventListener('click', () => { 
  if(confirm('Temizlensin mi?')){ 
    calcItems = []; 
    renderCalcItems(); 
  } 
});

document.getElementById('addCategoryBtn').addEventListener('click', addCategory);
document.getElementById('addProductBtn').addEventListener('click', addProduct);
  // Toplu ekleme fonksiyonları
document.getElementById('quickAddProductsBtn').addEventListener('click', () => {
  document.getElementById('quickAddModal').style.display = 'flex';
});

document.getElementById('closeQuickAddModal').addEventListener('click', () => {
  document.getElementById('quickAddModal').style.display = 'none';
});

document.getElementById('confirmQuickAdd').addEventListener('click', quickAddProducts);

document.getElementById('cancelQuickAdd').addEventListener('click', () => {
  document.getElementById('quickAddModal').style.display = 'none';
});

function quickAddProducts() {
  const text = document.getElementById('quickProductsText').value.trim();
  if (!text) {
    alert('Lütfen ürün verilerini girin!');
    return;
  }
  
  const lines = text.split('\n');
  let currentCategory = null;
  let currentProduct = null;
  let addedCategories = 0;
  let addedProducts = 0;
  let addedIngredients = 0;
  
  lines.forEach(line => {
    line = line.trim();
    if (!line) return;
    
    if (line.startsWith('+')) {
      // Kategori satırı
      const name = line.substring(1).trim();
      const categoryId = name.toLowerCase()
        .replace(/[ğüşıöç]/g, function(match) {
          const map = {'ğ':'g','ü':'u','ş':'s','ı':'i','ö':'o','ç':'c'};
          return map[match];
        })
        .replace(/[^a-z0-9]/g, '_');
      
      // Kategori var mı kontrol et
      let existingCategory = CATEGORIES.find(cat => cat.id === categoryId);
      if (!existingCategory) {
        const newCategory = {
          id: categoryId,
          name: name,
          imageUrl: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=200'
        };
        CATEGORIES.push(newCategory);
        addedCategories++;
      }
      currentCategory = categoryId;
      currentProduct = null;
      
    } else if (line.startsWith('-')) {
      // Ürün satırı
      const name = line.substring(1).trim();
      if (!currentCategory) {
        alert('Lütfen önce bir kategori ekleyin!');
        return;
      }
      
      RECIPES[name] = {
        category: currentCategory,
        imageUrl: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=200',
        ingredients: []
      };
      
      currentProduct = name;
      addedProducts++;
      
    } else if (line && currentProduct) {
      // Malzeme satırı
      const ingredientMatch = line.match(/^([^:]+):\s*(\d+(\.\d+)?)\s*(\S+)$/);
      if (ingredientMatch) {
        const name = ingredientMatch[1].trim();
        const qty = parseFloat(ingredientMatch[2]);
        const unit = ingredientMatch[4].trim();
        
        if (RECIPES[currentProduct]) {
          RECIPES[currentProduct].ingredients.push({
            name: name,
            qty: qty,
            unit: unit
          });
          addedIngredients++;
        }
      }
    }
  });
  
  // LocalStorage'a kaydet
  localStorage.setItem('maliq_categories', JSON.stringify(CATEGORIES));
  localStorage.setItem('maliq_recipes', JSON.stringify(RECIPES));
  
  // UI'yı güncelle
  document.getElementById('quickAddModal').style.display = 'none';
  document.getElementById('quickProductsText').value = '';
  
  renderCategories();
  renderProducts(null);
  renderProductsManagementPanel();
  renderCategoriesManagementPanel();
  updateSiteStats();
  
  alert(`${addedCategories} kategori, ${addedProducts} ürün ve ${addedIngredients} malzeme eklendi!`);
}

// Veri yönetimi fonksiyonları
document.getElementById('exportAllDataBtn').addEventListener('click', exportAllData);
document.getElementById('importAllDataBtn').addEventListener('click', importAllData);
document.getElementById('resetDataBtn').addEventListener('click', resetData);

function exportAllData() {
  const data = {
    categories: CATEGORIES,
    recipes: RECIPES,
    saved: savedListArr,
    exportDate: new Date().toISOString()
  };
  
  const dataStr = JSON.stringify(data, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  
  const url = URL.createObjectURL(dataBlob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'maliq_backup_' + new Date().toISOString().split('T')[0] + '.json';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function importAllData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  
  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    
    reader.onload = function(event) {
      try {
        const data = JSON.parse(event.target.result);
        
        if (confirm('Mevcut verilerin üzerine yazılacak. Emin misiniz?')) {
          if (data.categories) {
            CATEGORIES = data.categories;
            localStorage.setItem('maliq_categories', JSON.stringify(CATEGORIES));
          }
          
          if (data.recipes) {
            RECIPES = data.recipes;
            localStorage.setItem('maliq_recipes', JSON.stringify(RECIPES));
          }
          
          if (data.saved) {
            savedListArr = data.saved;
            localStorage.setItem('maliq_saved', JSON.stringify(savedListArr));
          }
          
          // UI'yı yenile
          renderCategories();
          renderProducts(null);
          renderProductsManagementPanel();
          renderCategoriesManagementPanel();
          updateSiteStats();
          
          alert('Veriler başarıyla içe aktarıldı!');
        }
      } catch (err) {
        alert('Dosya okunamadı: ' + err.message);
      }
    };
    
    reader.readAsText(file);
  };
  
  input.click();
}

function resetData() {
  if (confirm('TÜM veriler sıfırlanacak. Bu işlem geri alınamaz! Emin misiniz?')) {
    localStorage.clear();
    location.reload();
  }
}

// Initialize
setupUserInfo();
renderCategories();
renderProducts(null);
setActiveTab('categories');
updateSiteStats();

function updateSiteStats() {
  document.getElementById('totalRecipes').textContent = Object.keys(RECIPES).length;
  document.getElementById('totalIngredients').textContent = Object.values(RECIPES).reduce((acc, recipe) => acc + (recipe.ingredients ? recipe.ingredients.length : 0), 0);
  document.getElementById('totalCategories').textContent = CATEGORIES.length;
}

if (isAdmin) {
  renderProductsManagementPanel();
  renderCategoriesManagementPanel();
}
  <!-- Quick Add Modal -->
  <div id="quickAddModal" class="modal">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <div style="font-weight:900">Hızlı Ürün Ekle</div>
        <button id="closeQuickAddModal" class="btn-ghost">Kapat</button>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <div class="small-note">+ işareti kategori, - işareti ürün ekler. Malzemeleri ürün altına yazın.</div>
        <div class="small-note" style="color:var(--accent1)">Örnek:<br>+ YUMURTA ÇEŞİTLERİ<br>- Sucuklu Yumurta<br>Sucuk: 120 gr<br>Yumurta: 3 adet</div>
        <textarea id="quickProductsText" class="input-small" placeholder="Buraya verileri yapıştırın..." rows="12" style="resize:vertical"></textarea>
        <div style="display:flex;gap:6px">
          <button id="confirmQuickAdd" class="btn-primary">Ekle</button>
          <button id="cancelQuickAdd" class="btn-ghost">İptal</button>
        </div>
      </div>
    </div>
  </div>
</script>
</body>
</html>
