<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>MALIQ Admin</title>
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data:;
                  script-src 'self' 'unsafe-inline' 'unsafe-eval' https: data:;
                  style-src 'self' 'unsafe-inline' https:;
                  connect-src 'self' https: wss:;
                  img-src 'self' https: data:;">
    
    <script src="https://cdn.jsdelivr.net/npm/@staticcms/app@1.0.0/dist/static-cms-app.js"></script>
</head>
<body>
    <div id="cms-root"></div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const config = {
            backend: {
                name: "github",
                repo: "candoruk96/maliq.github.io",
                branch: "main",
                auth_scope: "repo",
                api_root: "https://api.github.com"
            },
            local_backend: true,
            media_folder: "static/images",
            public_folder: "/images",
            collections: [{
                name: "recipes",
                label: "Tarifler",
                folder: "content/recipes",
                create: true,
                slug: "{{slug}}",
                fields: [
                    { name: "title", label: "Yemek Adı", widget: "string" },
                    { name: "emoji", label: "Emoji", widget: "string", required: false },
                    { name: "category", label: "Kategori", widget: "string" },
                    { 
                        label: "Malzemeler",
                        name: "ingredients",
                        widget: "list",
                        fields: [
                            { name: "name", label: "Ad", widget: "string" },
                            { name: "qty", label: "Miktar", widget: "string" },
                            { name: "unit", label: "Birim", widget: "string" }
                        ]
                    },
                    { name: "instructions", label: "Tarif Metni", widget: "markdown" }
                ]
            }]
        };

        if (typeof StaticCMS !== 'undefined') {
            StaticCMS.init({ config });
        } else {
            // FALLBACK: Basit form göster
            document.getElementById('cms-root').innerHTML = `
                <div style="padding: 50px; max-width: 600px; margin: 0 auto;">
                    <h2>MALIQ Tarif Ekle</h2>
                    <form onsubmit="return false;">
                        <input type="text" placeholder="Yemek Adı" style="width: 100%; padding: 10px; margin: 5px 0;"><br>
                        <input type="text" placeholder="Kategori" style="width: 100%; padding: 10px; margin: 5px 0;"><br>
                        <textarea placeholder="Malzemeler" style="width: 100%; height: 100px; padding: 10px; margin: 5px 0;"></textarea><br>
                        <textarea placeholder="Tarif" style="width: 100%; height: 150px; padding: 10px; margin: 5px 0;"></textarea><br>
                        <button type="button" style="padding: 10px 20px; background: #007acc; color: white; border: none;">
                            GitHub'a Kaydet
                        </button>
                    </form>
                    <p><small>CMS engellendi. Manuel olarak GitHub'da dosya oluşturabilirsiniz.</small></p>
                </div>
            `;
        }
    });
    </script>
</body>
</html>
